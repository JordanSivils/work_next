generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Brand {
  id                    String      @id @default(uuid())
  name                  String      @unique                 
  slug                  String      @unique
  inventoriedById       String?
  lastInventoriedAt     DateTime?
  isActive              Boolean     @default(true)
  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt
  user                  User?       @relation(fields: [inventoriedById], references: [id], onDelete: SetNull)
  Product               Product[]
}

model Category {
  id   String @id @default(uuid())
  slug  String @unique
  name String @unique
  isActive  Boolean @default(true)
  Product Product[]
}

model ProductStaging {
  id             String        @id @default(uuid())
  description String?
  sku            String
  available      Int?
  brand String?
  category String?
  supplier String?
  margin Float?

  uploadId String 
  @@index([uploadId])
  @@index([sku])
}

model Product {
  id             String        @id @default(uuid())
  sku            String        @unique
  description    String        
  available      Int?
  margin         Float?
  brandId        String?
  categoryId     String?
  supplierId     String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime       @updatedAt
  Brand          Brand?        @relation(fields: [brandId], references: [id])
  Category       Category?     @relation(fields: [categoryId], references: [id])
  Supplier       Supplier?     @relation(fields: [supplierId], references: [id])

  @@index([brandId])
  @@index([categoryId])
  @@index([available])
  @@index([supplierId])
}

model SpecialOrder {
  id             String      @id @default(uuid())
  items          Json?
  notes          String?
  supplierId     String?
  customer       String?
  customerContact String?
  comments        String?
  orderStatus    OrderStatus  @default(requested)
  requestType     RequestType @default(order)
  existingItem   Boolean?     @default(false)

  createdById    String?
  initialOrderAt DateTime?
  nextOrderAt    DateTime?
  orderFrequency Int?
  recurring      Boolean     @default(false)

  processingAt   DateTime?
  lastRunAt      DateTime?
  lastError      String?


  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  User           User?       @relation(fields: [createdById], references: [id], onDelete: SetNull)
  Supplier       Supplier?   @relation(fields: [supplierId], references: [id])

  @@index([nextOrderAt])
  @@index([orderStatus])
  @@index([recurring])
  @@index([supplierId])
}

model Supplier {
  id              String           @id @default(uuid())
  name            String           @unique
  slug            String           @unique
  orderDay        String?
  orderNotes      String?
  orderMinimum    String?
  isActive  Boolean @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  userId          String?
  User            User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  Product         Product[]
  SpecialOrder    SpecialOrder[]
}

model User {
  id              String            @id @default(uuid())
  clerkId         String            @unique
  firstName       String            
  lastName        String            
  email           String?            @unique
  phoneNumber     String?
  isActive        Boolean           @default(true)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  SpecialOrder    SpecialOrder[]
  Supplier Supplier[]
  Brand Brand[]
}

enum OrderStatus {
  requested
  rejected
  ordered
  received
  shorted
}

enum RequestType {
  cost
  order
}