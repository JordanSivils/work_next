generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Brand {
  id           String         @id
  name         String         @unique
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  Item         Item[]
  SpecialOrder SpecialOrder[]
  Supplier     Supplier[]
}

model Category {
  id   String @id
  name String @unique
  Item Item[]
}

model Item {
  id             String        @id
  sku            String        @unique
  description    String
  status         ItemStatus    @default(standard)
  available      Int?
  manufacturerId String?
  brandId        String?
  categoryId     String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  Brand          Brand?        @relation(fields: [brandId], references: [id])
  Category       Category?     @relation(fields: [categoryId], references: [id])
  Manufacturer   Manufacturer? @relation(fields: [manufacturerId], references: [id])
  Supplier       Supplier[]

  @@index([brandId])
  @@index([categoryId])
  @@index([manufacturerId])
  @@index([status])
}

model Manufacturer {
  id        String   @id
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime
  Item      Item[]
}

model SpecialOrder {
  id             String      @id
  items          Json?
  notes          String?
  brandId        String?
  supplierId     String?
  orderStatus    OrderStatus @default(requested)
  existingItem   Boolean     @default(false)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime
  createdById    String?
  initialOrderAt DateTime?
  nextOrderAt    DateTime?
  orderFrequency Int?
  recurring      Boolean     @default(false)
  Brand          Brand?      @relation(fields: [brandId], references: [id])
  User           User?       @relation(fields: [createdById], references: [id])
  Supplier       Supplier?   @relation(fields: [supplierId], references: [id])

  @@index([nextOrderAt])
  @@index([orderStatus])
  @@index([recurring])
  @@index([supplierId])
}

model Supplier {
  id              String           @id
  name            String           @unique
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  SpecialOrder    SpecialOrder[]
  SupplierDetails SupplierDetails?
  Brand           Brand[]
  Item            Item[]
}

model SupplierDetails {
  id           String   @id
  userId       String?
  orderDay     String?
  orderNotes   String?
  orderMinimum String?
  supplierId   String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  Supplier     Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  User         User?    @relation(fields: [userId], references: [id])

  @@index([userId])
}

model User {
  id              String            @id
  clerkId         String            @unique
  firstName       String
  lastName        String
  email           String            @unique
  phoneNumber     String
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  SpecialOrder    SpecialOrder[]
  SupplierDetails SupplierDetails[]
}

enum ItemStatus {
  negative
  standard
}

enum OrderStatus {
  requested
  rejected
  ordered
  received
  shorted
}
