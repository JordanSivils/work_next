generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Brand {
  id                String    @id
  name              String    @unique
  slug              String    @unique
  inventoriedById   String?
  lastInventoriedAt DateTime?
  isActive          Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  User              User?     @relation(fields: [inventoriedById], references: [id])
  Product           Product[]
}

model Category {
  id       String    @id
  slug     String    @unique
  name     String    @unique
  isActive Boolean   @default(true)
  Product  Product[]
}

model SpecialOrder {
  id              String      @id
  items           Json?
  notes           String?
  supplierId      String?
  customer        String?
  customerContact String?
  comments        String?
  orderStatus     OrderStatus @default(requested)
  requestType     RequestType @default(order)
  existingItem    Boolean?    @default(false)
  createdById     String?
  initialOrderAt  DateTime?
  nextOrderAt     DateTime?
  orderFrequency  Int?
  recurring       Boolean     @default(false)
  processingAt    DateTime?
  lastRunAt       DateTime?
  lastError       String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime
  User            User?       @relation(fields: [createdById], references: [id])
  Supplier        Supplier?   @relation(fields: [supplierId], references: [id])

  @@index([nextOrderAt])
  @@index([orderStatus])
  @@index([recurring])
  @@index([supplierId])
}

model Supplier {
  id           String         @id
  name         String         @unique
  slug         String         @unique
  orderDay     String?
  orderNotes   String?
  orderMinimum String?
  isActive     Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  userId       String?
  Product      Product[]
  SpecialOrder SpecialOrder[]
  User         User?          @relation(fields: [userId], references: [id])
}

model User {
  id           String         @id
  clerkId      String         @unique
  firstName    String
  lastName     String
  email        String?        @unique
  phoneNumber  String?
  isActive     Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  Brand        Brand[]
  SpecialOrder SpecialOrder[]
  Supplier     Supplier[]
}

model Product {
  id          String    @id
  sku         String    @unique
  description String
  available   Int?
  margin      Float?
  brandId     String?
  categoryId  String?
  supplierId  String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  Brand       Brand?    @relation(fields: [brandId], references: [id])
  Category    Category? @relation(fields: [categoryId], references: [id])
  Supplier    Supplier? @relation(fields: [supplierId], references: [id])

  @@index([available])
  @@index([brandId])
  @@index([categoryId])
  @@index([supplierId])
}

model ProductStaging {
  id          String  @id
  description String?
  sku         String
  available   Int?
  brand       String?
  category    String?
  supplier    String?
  margin      Float?
  uploadId    String

  @@index([sku])
  @@index([uploadId])
}

enum OrderStatus {
  requested
  rejected
  ordered
  received
  shorted
}

enum RequestType {
  cost
  order
}
